<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Document</title>
		<style>
			*:focus {
				outline: none;
			}
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				background: #001;
				color: aliceblue;
				position: relative;
			}
			form {
				position: relative;
				display: flex;
				gap: 20px;
				flex-wrap: wrap;
				padding: 20px;
				width: 80%;
			}
			form div {
				display: flex;
				gap: 10px;
			}

			input[type="number"] {
				padding: 5px;
				font-size: 16px;
				background: #012;
				color: aliceblue;
				border: 1px solid aliceblue;
				border-radius: 5px;
			}
			input[type="range"] {
				cursor: pointer;
				scale: 1.2;
			}
			button {
				padding: 5px;
				border: 1px solid aliceblue;
				border-radius: 5px;
				background: #012;
				color: aliceblue;
				cursor: pointer;
			}

			@media (max-width: 800px) {
				form {
					flex-direction: column;
				}
				input[type="range"] {
					width: 50%;
				}
			}
			@media (max-width: 500px) {
				form {
					width: 50%;
				}
				form div {
					flex-direction: column;
				}
				input[type="range"] {
					width: 100%;
				}
			}

			.wrapper {
				width: 100%;
				display: flex;
				flex-wrap: wrap;
				justify-content: flex-start;
				gap: min(20px, var(--size) / 10);
				padding: 0 0 0 10px;
			}
			.item {
				--padding: 20px;
				position: relative;
				display: flex;
				flex-direction: column;
				gap: 10px;
				border: 1px solid #333;
				padding: min(var(--size) / 15, var(--padding));
				width: var(--size);
				height: var(--size);
			}
			.item img {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				object-fit: contain;
			}
			.done {
				color: #00b300;
			}
			.generating {
				color: red;
			}
			label {
				width: 50px;
				text-align: center;
			}
			aside {
				position: fixed;
				top: 10px;
				right: -200px;
				display: flex;
				flex-direction: column;
				padding: 10px;
				background: #023;
				border-radius: 10px;
				transition: 0.5s ease-in-out;
				border: 1px solid antiquewhite;
			}
			aside.active {
				right: 10px;
			}
		</style>
	</head>
	<body style="--size: 200px">
		<header>
			<form>
				<div>
					<input type="number" placeholder="Number of images" />
					<button type="submit">Generate</button>
				</div>
				<span class="status">Status: waiting for input</span>
				<div>
					<span>Image size (50px - 600px):</span>
					<label></label>
				</div>
				<input
					type="range"
					min="50"
					max="600"
					value="200"
					oninput="changeSize()"
				/>
			</form>
		</header>
		<div class="wrapper"></div>
		<aside>
			<span class="requested">Requested: 0</span>
			<span class="generated">Generated: 0</span>
			<span class="skipped">Skipped: 0</span>
			<span class="status">Skipped: 0</span>
		</aside>
		<script>
			const chars =
					"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",
				baseURL = "https://i.imgur.com/",
				form = document.querySelector("form"),
				input = document.querySelector("input"),
				wrongInput = document.querySelector(".wrong-input"),
				wrapper = document.querySelector(".wrapper"),
				status = document.querySelectorAll(".status"),
				range = document.querySelector("input[type=range]"),
				label = document.querySelector("label"),
				requested = document.querySelector(".requested"),
				generated = document.querySelector(".generated"),
				skipped = document.querySelector(".skipped"),
				aside = document.querySelector("aside"),
				generateID = () =>
					Array.from(
						Array(5),
						() => chars[Math.floor(Math.random() * chars.length)]
					).join(""),
				generateURL = () => baseURL + generateID() + ".jpg",
				createImage = () => {
					const img = new Image()
					img.onload = () => {
						if (img.width !== 168 && img.height !== 81) {
							const div = createBox(),
								a = document.createElement("a")

							a.appendChild(img)
							a.href = img.src
							a.target = "_blank"
							div.appendChild(a)
							wrapper.appendChild(div)
						}
					}
					img.src = generateURL()
				},
				createBox = () => {
					const div = document.createElement("div")
					div.classList.add("item")
					return div
				},
				sleep = ms => new Promise(resolve => setTimeout(resolve, ms)),
				changeSize = () => {
					document.body.style.setProperty(
						"--size",
						range.value + "px"
					)
					label.innerText = range.value + "px"
				},
				updateStatus = type => {
					if (type == "generating") {
						status.forEach(e => {
							e.classList.add("generating")
							e.classList.remove("done")
							e.innerText = "Status: generating..."
						})
					} else if (type == "done") {
						status.forEach(e => {
							e.classList.remove("generating")
							e.classList.add("done")
							e.innerText = "Status: done"
						})
					}
				}

			form.addEventListener("submit", async e => {
				e.preventDefault()

				const value = +input.value,
					initialLength = wrapper.childNodes.length
				let length = initialLength,
					i = 0

				updateStatus("generating")
				requested.innerText = `Requested: ${value}`

				while (length < initialLength + value) {
					createImage()
					await sleep(75)
					if (wrapper.childNodes.length > length) {
						length++
						generated.innerText = `Generated: ${
							wrapper.childNodes.length - initialLength
						}`
						skipped.innerText = `Skipped: ${i}`
					} else console.log("image skipped"), i++
				}

				await sleep(400)

				updateStatus("done")

				generated.innerText = `Generated: ${
					wrapper.childNodes.length - initialLength
				}`

				console.log(
					`Requested: ${value} image(s), generated: ${
						wrapper.childNodes.length - initialLength
					} image(s), skipped: ${i} image(s)`
				)
			})

			const observer = new IntersectionObserver(entries => {
				entries.forEach(entry => {
					if (entry.isIntersecting) aside.classList.remove("active")
					else aside.classList.add("active")
				})
			})

			observer.observe(form)

			changeSize()
			input.focus()
		</script>
	</body>
</html>
